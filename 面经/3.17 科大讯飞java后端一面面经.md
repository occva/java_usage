
---
### ğŸ¤– Assistant

# Javaæ ¸å¿ƒæ¦‚å¿µè¯¦è§£

## é›†åˆæ¡†æ¶

### ArrayList
- **ç‰¹æ€§**ï¼šåŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œæ”¯æŒéšæœºè®¿é—®
- **å†…éƒ¨ç»“æ„**ï¼šObject[]æ•°ç»„å­˜å‚¨å…ƒç´ 
- **æ€§èƒ½ç‰¹ç‚¹**ï¼š
  - éšæœºè®¿é—® O(1)
  - å°¾éƒ¨æ·»åŠ  O(1) å¹³å‡æƒ…å†µï¼ˆæ‰©å®¹æ—¶éœ€è¦O(n)ï¼‰
  - ä¸­é—´æ’å…¥/åˆ é™¤ O(n)ï¼ˆéœ€è¦ç§»åŠ¨å…ƒç´ ï¼‰
- **æ‰©å®¹æœºåˆ¶**ï¼šå½“å®¹é‡ä¸è¶³æ—¶ï¼Œæ‰©å®¹ä¸ºåŸå®¹é‡çš„1.5å€
  ```java
  int newCapacity = oldCapacity + (oldCapacity >> 1);
  ```
- **çº¿ç¨‹å®‰å…¨**ï¼šéçº¿ç¨‹å®‰å…¨ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒå¯ä½¿ç”¨`Collections.synchronizedList()`æˆ–`CopyOnWriteArrayList`

### LinkedList
- **ç‰¹æ€§**ï¼šåŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œæ“…é•¿æ’å…¥/åˆ é™¤æ“ä½œ
- **å†…éƒ¨ç»“æ„**ï¼šåŒå‘é“¾è¡¨èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼ŒåŒ…å«å‰é©±åç»§æŒ‡é’ˆ
  ```java
  private static class Node<E> {
      E item;
      Node<E> next;
      Node<E> prev;
  }
  ```
- **æ€§èƒ½ç‰¹ç‚¹**ï¼š
  - éšæœºè®¿é—® O(n)ï¼ˆéœ€è¦éå†ï¼‰
  - æ’å…¥/åˆ é™¤ O(1)ï¼ˆå·²çŸ¥ä½ç½®æƒ…å†µä¸‹ï¼‰
  - å¤´å°¾æ“ä½œ O(1)ï¼ˆé€šè¿‡first/lastå¼•ç”¨ï¼‰
- **é¢å¤–ç‰¹æ€§**ï¼šå®ç°äº†Dequeæ¥å£ï¼Œå¯ä½œä¸ºé˜Ÿåˆ—å’Œæ ˆä½¿ç”¨

### HashMap
- **ç‰¹æ€§**ï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°çš„é”®å€¼å¯¹é›†åˆï¼Œå…è®¸nullé”®å’Œå€¼
- **å†…éƒ¨ç»“æ„**ï¼š
  - æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ˆJava 8+ï¼‰
  - é“¾è¡¨é•¿åº¦>8ä¸”æ•°ç»„é•¿åº¦>=64æ—¶è½¬ä¸ºçº¢é»‘æ ‘
- **è´Ÿè½½å› å­**ï¼šé»˜è®¤0.75ï¼Œå½±å“æ‰©å®¹æ—¶æœºå’Œå†²çªæ¦‚ç‡
- **æ€§èƒ½ç‰¹ç‚¹**ï¼š
  - æŸ¥æ‰¾/æ’å…¥/åˆ é™¤å¹³å‡O(1)ï¼Œæœ€å·®O(log n)ï¼ˆæ ‘åŒ–åï¼‰
- **æ‰©å®¹æœºåˆ¶**ï¼šå®¹é‡ç¿»å€ï¼Œé‡æ–°åˆ†å¸ƒå…ƒç´ ï¼ˆrehashï¼‰
- **çº¿ç¨‹å®‰å…¨**ï¼šéçº¿ç¨‹å®‰å…¨

## ConcurrentHashMapä¸HashMapçš„åŒºåˆ«

| ç‰¹æ€§ | HashMap | ConcurrentHashMap |
|------|---------|-------------------|
| çº¿ç¨‹å®‰å…¨ | å¦ | æ˜¯ |
| é”æœºåˆ¶ | æ—  | åˆ†æ®µé”ï¼ˆJava 7ï¼‰ï¼ŒCAS+synchronizedï¼ˆJava 8+ï¼‰ |
| nullé”®/å€¼ | å…è®¸ | ä¸å…è®¸ |
| å®ç°æ–¹å¼ | æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ | åŒå·¦ï¼Œä½†åŠ å…¥äº†å¹¶å‘æ§åˆ¶ |
| æ€§èƒ½ | å•çº¿ç¨‹ä¸‹æ›´ä¼˜ | é«˜å¹¶å‘ä¸‹è¡¨ç°æ›´å¥½ |

**ConcurrentHashMapçš„å¹¶å‘å®ç°ï¼ˆJava 8ï¼‰**ï¼š
- ä½¿ç”¨CASæ“ä½œè¿›è¡Œæ— é”å¹¶å‘æ§åˆ¶
- ä»…åœ¨hashå†²çªæ—¶æ‰ä½¿ç”¨synchronizedé”ä½é“¾è¡¨å¤´èŠ‚ç‚¹
- ä½¿ç”¨volatileç¡®ä¿å¯è§æ€§
- æ”¯æŒå¤šçº¿ç¨‹æ‰©å®¹ï¼Œé€šè¿‡transferæ“ä½œåˆ†é…ä»»åŠ¡

**ä»£ç ç‰‡æ®µ**ï¼š
```java
// ConcurrentHashMapä¸­çš„putæ“ä½œï¼ˆç®€åŒ–ç‰ˆï¼‰
final V putVal(K key, V value, boolean onlyIfAbsent) {
    // ...
    for (Node<K,V>[] tab = table;;) {
        // ... 
        if ((f = tabAt(tab, i)) == null) {
            // ä½¿ç”¨CASå°è¯•æ’å…¥æ–°èŠ‚ç‚¹
            if (casTabAt(tab, i, null, new Node<K,V>(hash, key, value)))
                break;
        }
        else if (/* éœ€è¦æ‰©å®¹çš„æ¡ä»¶ */) {
            // ååŠ©æ‰©å®¹
            tab = helpTransfer(tab, f);
        }
        else {
            // hashå†²çªï¼Œé”ä½æ¡¶
            synchronized (f) {
                if (tabAt(tab, i) == f) {
                    // é“¾è¡¨æˆ–çº¢é»‘æ ‘æ“ä½œ
                }
            }
            break;
        }
    }
    // ...
}
```

## StringBufferä¸StringBuilderçš„åŒºåˆ«

| ç‰¹æ€§ | StringBuffer | StringBuilder |
|------|--------------|---------------|
| çº¿ç¨‹å®‰å…¨ | æ˜¯ï¼ˆsynchronizedï¼‰ | å¦ |
| æ€§èƒ½ | è¾ƒæ…¢ï¼ˆæœ‰åŒæ­¥å¼€é”€ï¼‰ | æ›´å¿«ï¼ˆæ— åŒæ­¥ï¼‰ |
| é€‚ç”¨åœºæ™¯ | å¤šçº¿ç¨‹å…±äº« | å•çº¿ç¨‹æ“ä½œ |
| å¼•å…¥ç‰ˆæœ¬ | JDK 1.0 | JDK 1.5 |

**æ ¸å¿ƒåŒºåˆ«**ï¼šStringBufferçš„æ–¹æ³•ä½¿ç”¨synchronizedä¿®é¥°ï¼Œè€ŒStringBuilderæ²¡æœ‰åŒæ­¥æ§åˆ¶ã€‚

**ä»£ç å¯¹æ¯”**ï¼š
```java
// StringBufferçš„appendæ–¹æ³•
@Override
public synchronized StringBuffer append(String str) {
    toStringCache = null;
    super.append(str);
    return this;
}

// StringBuilderçš„appendæ–¹æ³•
@Override
public StringBuilder append(String str) {
    super.append(str);
    return this;
}
```

## çº¿ç¨‹æ± åˆ›å»ºæ–¹å¼å’Œå‚æ•°

### åˆ›å»ºæ–¹å¼

1. **é€šè¿‡Executorså·¥å‚æ–¹æ³•**ï¼ˆä¸æ¨èç”¨äºç”Ÿäº§ï¼‰ï¼š
   ```java
   ExecutorService fixedPool = Executors.newFixedThreadPool(10);
   ExecutorService cachedPool = Executors.newCachedThreadPool();
   ExecutorService singlePool = Executors.newSingleThreadExecutor();
   ScheduledExecutorService scheduledPool = Executors.newScheduledThreadPool(5);
   ```

2. **æ‰‹åŠ¨åˆ›å»º**ï¼ˆæ¨èï¼‰ï¼š
   ```java
   ThreadPoolExecutor executor = new ThreadPoolExecutor(
       corePoolSize,      // æ ¸å¿ƒçº¿ç¨‹æ•°
       maximumPoolSize,   // æœ€å¤§çº¿ç¨‹æ•°
       keepAliveTime,     // ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´
       timeUnit,          // æ—¶é—´å•ä½
       workQueue,         // å·¥ä½œé˜Ÿåˆ—
       threadFactory,     // çº¿ç¨‹å·¥å‚
       rejectedHandler    // æ‹’ç»ç­–ç•¥
   );
   ```

### å…³é”®å‚æ•°è§£æ

- **corePoolSize**ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šè¢«å›æ”¶
- **maximumPoolSize**ï¼šæœ€å¤§çº¿ç¨‹æ•°ï¼Œé˜Ÿåˆ—æ»¡æ—¶å¯ä»¥åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°
- **keepAliveTime**ï¼šç©ºé—²çº¿ç¨‹çš„ä¿ç•™æ—¶é—´ï¼ˆè¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ï¼‰
- **workQueue**ï¼šä»»åŠ¡ç­‰å¾…é˜Ÿåˆ—ï¼Œå¸¸ç”¨å®ç°ï¼š
  - ArrayBlockingQueueï¼ˆæœ‰ç•Œé˜Ÿåˆ—ï¼‰
  - LinkedBlockingQueueï¼ˆæ— ç•Œé˜Ÿåˆ—ï¼‰
  - SynchronousQueueï¼ˆç›´æ¥äº¤æ¥ï¼‰
  - PriorityBlockingQueueï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰
- **rejectedHandler**ï¼šæ‹’ç»ç­–ç•¥ï¼Œå½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡æ—¶çš„å¤„ç†æ–¹å¼ï¼š
  - AbortPolicyï¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰
  - CallerRunsPolicyï¼šè°ƒç”¨è€…çº¿ç¨‹æ‰§è¡Œ
  - DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒ
  - DiscardOldestPolicyï¼šä¸¢å¼ƒæœ€æ—§ä»»åŠ¡

### çº¿ç¨‹æ± å·¥ä½œæµç¨‹

1. å½“æäº¤ä»»åŠ¡æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œ
2. å¦‚æœçº¿ç¨‹æ•°å·²è¾¾æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—
3. å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œä½†çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œ
4. å¦‚æœé˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥

## synchronizedå’ŒReentrantLockçš„åŒºåˆ«

| ç‰¹æ€§ | synchronized | ReentrantLock |
|------|--------------|---------------|
| é”å®ç° | JVMå±‚é¢ï¼ˆmonitorenter/monitorexitï¼‰ | APIå±‚é¢ï¼ˆAQSæ¡†æ¶ï¼‰ |
| é”ç±»å‹ | éå…¬å¹³é” | æ”¯æŒå…¬å¹³å’Œéå…¬å¹³é” |
| æ¡ä»¶é˜Ÿåˆ— | ä¸€ä¸ª | å¯å¤šä¸ªï¼ˆConditionï¼‰ |
| è·å–æ–¹å¼ | éšå¼è·å–å’Œé‡Šæ”¾ | æ˜¾å¼è·å–å’Œé‡Šæ”¾ï¼ˆtry-finallyï¼‰ |
| ä¸­æ–­ | ä¸æ”¯æŒä¸­æ–­ | æ”¯æŒä¸­æ–­ï¼ˆlockInterruptiblyï¼‰ |
| è¶…æ—¶å°è¯• | ä¸æ”¯æŒ | æ”¯æŒï¼ˆtryLock+timeoutï¼‰ |
| æ€§èƒ½ | 1.6åä¼˜åŒ–ï¼ˆåå‘é”/è½»é‡çº§é”ï¼‰ | ç«äº‰æ¿€çƒˆæ—¶è¾ƒå¥½ |

**ReentrantLockç‹¬æœ‰ç‰¹æ€§**ï¼š
- å¯ä¸­æ–­é”è·å–ï¼ˆlockInterruptiblyï¼‰
- å¸¦è¶…æ—¶çš„é”è·å–ï¼ˆtryLock(time)ï¼‰
- å…¬å¹³é”é€‰é¡¹
- å¤šæ¡ä»¶å˜é‡ï¼ˆconditionï¼‰

**ä»£ç å¯¹æ¯”**ï¼š
```java
// synchronized
synchronized(lock) {
    // ä¸´ç•ŒåŒºä»£ç 
}

// ReentrantLock
Lock lock = new ReentrantLock();
try {
    lock.lock();  // æˆ–lock.tryLock(1, TimeUnit.SECONDS)
    // ä¸´ç•ŒåŒºä»£ç 
} finally {
    lock.unlock();
}

// å¤šæ¡ä»¶ç¤ºä¾‹
Lock lock = new ReentrantLock();
Condition notFull = lock.newCondition();
Condition notEmpty = lock.newCondition();

// åœ¨ä¸åŒæ¡ä»¶ä¸‹ç­‰å¾…/é€šçŸ¥
lock.lock();
try {
    while(é˜Ÿåˆ—æ»¡) notFull.await();
    // æ·»åŠ å…ƒç´ ...
    notEmpty.signal();
} finally {
    lock.unlock();
}
```

## åŒäº²å§”æ´¾æœºåˆ¶å’Œä¼˜ç‚¹

### åŒäº²å§”æ´¾æœºåˆ¶å®šä¹‰

Javaç±»åŠ è½½é‡‡ç”¨"åŒäº²å§”æ´¾æ¨¡å‹"ï¼Œé™¤Bootstrap ClassLoaderå¤–ï¼Œæ‰€æœ‰ç±»åŠ è½½å™¨éƒ½æœ‰çˆ¶åŠ è½½å™¨ã€‚åŠ è½½ç±»æ—¶ï¼Œå…ˆå§”æ‰˜çˆ¶åŠ è½½å™¨å°è¯•åŠ è½½ï¼Œçˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½æ‰è‡ªå·±åŠ è½½ã€‚

### å…·ä½“åŠ è½½è¿‡ç¨‹

1. åº”ç”¨ç±»åŠ è½½å™¨æ”¶åˆ°åŠ è½½è¯·æ±‚
2. å°†è¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨ï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰å¤„ç†
3. æ‰©å±•ç±»åŠ è½½å™¨å†å§”æ‰˜ç»™å¼•å¯¼ç±»åŠ è½½å™¨
4. å¼•å¯¼ç±»åŠ è½½å™¨æ£€æŸ¥æ˜¯å¦èƒ½åŠ è½½è¯¥ç±»
   - èƒ½ï¼šæ‰§è¡ŒåŠ è½½å¹¶è¿”å›ç»“æœ
   - ä¸èƒ½ï¼šæ‰©å±•ç±»åŠ è½½å™¨å°è¯•åŠ è½½
5. å¦‚æ­¤é€’å½’ï¼Œç›´åˆ°çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½ï¼Œæœ€ç»ˆç”±å‘èµ·è¯·æ±‚çš„åŠ è½½å™¨è‡ªå·±åŠ è½½

### åŒäº²å§”æ´¾çš„ä¼˜ç‚¹

1. **å®‰å…¨æ€§**ï¼šé˜²æ­¢æ ¸å¿ƒAPIè¢«ç¯¡æ”¹
   - ä¾‹å¦‚ï¼Œè‡ªå®šä¹‰java.lang.Stringç±»æ— æ³•è¢«åŠ è½½æ›¿æ¢JDKçš„Stringç±»
   
2. **é¿å…ç±»é‡å¤åŠ è½½**ï¼šçˆ¶åŠ è½½å™¨å·²åŠ è½½çš„ç±»ï¼Œå­åŠ è½½å™¨ä¸ä¼šå†æ¬¡åŠ è½½

3. **ä¿è¯ç±»çš„å”¯ä¸€æ€§**ï¼šç¡®ä¿åŒä¸€ä¸ªç±»åœ¨JVMä¸­åªæœ‰ä¸€ä¸ªClasså®ä¾‹

### ä»£ç å®ç°

```java
protected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException {
    synchronized (getClassLoadingLock(name)) {
        // é¦–å…ˆæ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡
        Class<?> c = findLoadedClass(name);
        if (c == null) {
            // å¦‚æœæ²¡æœ‰åŠ è½½è¿‡ï¼Œå§”æ‰˜çˆ¶åŠ è½½å™¨åŠ è½½
            try {
                if (parent != null) {
                    c = parent.loadClass(name, false);
                } else {
                    c = findBootstrapClassOrNull(name);
                }
            } catch (ClassNotFoundException e) {
                // çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶æŠ›å‡ºå¼‚å¸¸
            }
            
            // å¦‚æœçˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½ï¼Œåˆ™å°è¯•è‡ªå·±åŠ è½½
            if (c == null) {
                c = findClass(name);
            }
        }
        if (resolve) {
            resolveClass(c);
        }
        return c;
    }
}
```

## å¸¸è§çš„ç±»åŠ è½½æœºåˆ¶

### Javaç±»åŠ è½½å™¨å±‚æ¬¡ç»“æ„

1. **å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰**
   - æœ€é¡¶å±‚åŠ è½½å™¨ï¼ŒC++å®ç°ï¼ˆéJavaç±»ï¼‰
   - åŠ è½½Javaæ ¸å¿ƒç±»åº“ï¼ˆ`$JAVA_HOME/jre/lib/rt.jar`ç­‰ï¼‰
   - åŠ è½½æ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç±»åŠ è½½å™¨

2. **æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰**
   - åŠ è½½æ‰©å±•åº“ï¼ˆ`$JAVA_HOME/jre/lib/ext`ç›®å½•ï¼‰
   - Java 9åæ”¹åä¸ºPlatform ClassLoader

3. **åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰**
   - ä¹Ÿç§°ç³»ç»Ÿç±»åŠ è½½å™¨
   - åŠ è½½åº”ç”¨classpathä¸Šçš„ç±»

4. **è‡ªå®šä¹‰ç±»åŠ è½½å™¨**
   - é€šè¿‡ç»§æ‰¿ClassLoaderå®ç°
   - ç”¨äºç‰¹æ®ŠåŠ è½½éœ€æ±‚ï¼ˆå¦‚çƒ­éƒ¨ç½²ã€éš”ç¦»åŠ è½½ç­‰ï¼‰

### ç±»åŠ è½½è¿‡ç¨‹

1. **åŠ è½½ï¼ˆLoadingï¼‰**
   - é€šè¿‡ç±»å…¨é™å®šåæŸ¥æ‰¾å­—èŠ‚ç æ–‡ä»¶
   - å°†å­—èŠ‚ç æ•°æ®åŠ è½½åˆ°å†…å­˜
   - åˆ›å»ºjava.lang.Classå®ä¾‹è¡¨ç¤ºè¯¥ç±»

2. **è¿æ¥ï¼ˆLinkingï¼‰**ï¼ŒåŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼š
   - **éªŒè¯ï¼ˆVerificationï¼‰**ï¼šç¡®ä¿å­—èŠ‚ç å®‰å…¨å¯æ‰§è¡Œ
   - **å‡†å¤‡ï¼ˆPreparationï¼‰**ï¼šä¸ºç±»é™æ€å˜é‡åˆ†é…å†…å­˜å¹¶è®¾é»˜è®¤å€¼
   - **è§£æï¼ˆResolutionï¼‰**ï¼šå°†ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨

3. **åˆå§‹åŒ–ï¼ˆInitializationï¼‰**
   - æ‰§è¡Œç±»æ„é€ å™¨<clinit>æ–¹æ³•
   - åˆå§‹åŒ–é™æ€å˜é‡ä¸ºå®é™…å€¼
   - æ‰§è¡Œé™æ€ä»£ç å—

### å¸¸è§çš„ç±»åŠ è½½å™¨æ‰“ç ´åŒäº²å§”æ´¾çš„åœºæ™¯

1. **SPIæœºåˆ¶ï¼ˆService Provider Interfaceï¼‰**
   - å¦‚JDBCé©±åŠ¨åŠ è½½ï¼Œä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆContextClassLoaderï¼‰

2. **OSGiæ¡†æ¶**
   - æ¨¡å—åŒ–ç³»ç»Ÿï¼Œæ¯ä¸ªBundleæœ‰ç‹¬ç«‹çš„ç±»åŠ è½½å™¨

3. **Tomcatå®¹å™¨**
   - å®ç°åº”ç”¨é—´éš”ç¦»ï¼Œæ¯ä¸ªWebåº”ç”¨æœ‰ç‹¬ç«‹çš„ç±»åŠ è½½å™¨

4. **çƒ­éƒ¨ç½²å®ç°**
   - å¦‚Springçš„DevToolsï¼Œé€šè¿‡æ›¿æ¢ç±»åŠ è½½å™¨å®ç°ç±»çš„çƒ­æ›´æ–°

## MySQLå­˜å‚¨å¼•æ“

MySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“æ¶æ„ï¼Œå¸¸è§çš„æœ‰ï¼š

### 1. InnoDBï¼ˆé»˜è®¤ï¼ŒMySQL 5.5+ï¼‰

- **ç‰¹ç‚¹**ï¼š
  - æ”¯æŒäº‹åŠ¡ï¼ˆACIDï¼‰
  - è¡Œçº§é”å®š
  - æ”¯æŒå¤–é”®çº¦æŸ
  - æ”¯æŒå´©æºƒæ¢å¤
  - é‡‡ç”¨MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰
  
- **å­˜å‚¨ç»“æ„**ï¼š
  - è¡¨ç©ºé—´å­˜å‚¨ï¼ˆ.ibdæ–‡ä»¶ï¼‰
  - èšç°‡ç´¢å¼•ï¼ˆæ•°æ®ä¸ä¸»é”®ç´¢å¼•æ”¾ä¸€èµ·ï¼‰
  
- **é€‚ç”¨åœºæ™¯**ï¼š
  - éœ€è¦äº‹åŠ¡æ”¯æŒ
  - é«˜å¹¶å‘æ›´æ–°
  - éœ€è¦å¤–é”®æ”¯æŒçš„åº”ç”¨

### 2. MyISAMï¼ˆMySQL 5.5å‰çš„é»˜è®¤ï¼‰

- **ç‰¹ç‚¹**ï¼š
  - ä¸æ”¯æŒäº‹åŠ¡
  - è¡¨çº§é”å®š
  - å…¨æ–‡ç´¢å¼•æ”¯æŒè¾ƒå¥½ï¼ˆ5.7ä¹‹å‰ï¼‰
  - è¯»å–æ€§èƒ½ä¼˜ç§€
  
- **å­˜å‚¨ç»“æ„**ï¼š
  - ä¸‰ä¸ªæ–‡ä»¶ï¼š.frmï¼ˆè¡¨å®šä¹‰ï¼‰ã€.MYDï¼ˆæ•°æ®ï¼‰ã€.MYIï¼ˆç´¢å¼•ï¼‰
  - éèšç°‡ç´¢å¼•ï¼ˆç´¢å¼•ä¸æ•°æ®åˆ†ç¦»ï¼‰
  
- **é€‚ç”¨åœºæ™¯**ï¼š
  - è¯»å¤šå†™å°‘ï¼ˆå¦‚ç½‘ç«™æ•°æ®åˆ†æï¼‰
  - å…¨æ–‡æ£€ç´¢åº”ç”¨
  - ä¸éœ€è¦äº‹åŠ¡çš„åœºæ™¯

### 3. Memoryï¼ˆHEAPï¼‰

- **ç‰¹ç‚¹**ï¼š
  - æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­
  - è¡¨çº§é”
  - ä¸æ”¯æŒBLOB/TEXTå­—æ®µ
  - é‡å¯åæ•°æ®ä¸¢å¤±
  
- **é€‚ç”¨åœºæ™¯**ï¼š
  - ä¸´æ—¶è¡¨/ä¸­é—´ç»“æœè¡¨
  - æŸ¥æ‰¾è¡¨ï¼ˆé€ŸæŸ¥è¡¨ï¼‰
  - ç¼“å­˜çƒ­ç‚¹æ•°æ®

### 4. Archive

- **ç‰¹ç‚¹**ï¼š
  - é«˜å‹ç¼©æ¯”
  - åªæ”¯æŒINSERTå’ŒSELECT
  - ä¸æ”¯æŒç´¢å¼•
  
- **é€‚ç”¨åœºæ™¯**ï¼š
  - æ—¥å¿—å’Œå†å²æ•°æ®å½’æ¡£
  - å®¡è®¡æ•°æ®

### 5. NDB/NDBCLUSTER

- **ç‰¹ç‚¹**ï¼š
  - åˆ†å¸ƒå¼ã€é›†ç¾¤å­˜å‚¨å¼•æ“
  - é«˜å¯ç”¨æ€§
  - å†…å­˜å­˜å‚¨
  
- **é€‚ç”¨åœºæ™¯**ï¼š
  - éœ€è¦é«˜å¯ç”¨æ€§çš„é›†ç¾¤ç¯å¢ƒ
  - å¤§è§„æ¨¡æ•°æ®åº“é›†ç¾¤

### å­˜å‚¨å¼•æ“å¯¹æ¯”

| ç‰¹æ€§ | InnoDB | MyISAM | Memory | Archive |
|------|--------|--------|--------|---------|
| äº‹åŠ¡ | æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ |
| é”ç²’åº¦ | è¡Œçº§ | è¡¨çº§ | è¡¨çº§ | è¡Œçº§ |
| å¤–é”® | æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ |
| å…¨æ–‡ç´¢å¼• | 5.6+æ”¯æŒ | æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ |
| æ•°æ®ç¼“å­˜ | æ”¯æŒ | ä¸æ”¯æŒ | N/Aï¼ˆå…¨å†…å­˜ï¼‰ | ä¸æ”¯æŒ |
| å‹ç¼© | æ”¯æŒ | æ”¯æŒ | ä¸æ”¯æŒ | æ”¯æŒï¼ˆé«˜å‹ç¼©ï¼‰ |
| æ–‡ä»¶å­˜å‚¨ | è¡¨ç©ºé—´ | ä¸‰ä¸ªæ–‡ä»¶ | å†…å­˜ | ç‰¹æ®Šæ ¼å¼æ–‡ä»¶ |
| å´©æºƒæ¢å¤ | æ”¯æŒ | ä¸å®Œå…¨æ”¯æŒ | æ•°æ®ä¸¢å¤± | æ”¯æŒ |

## AOP (é¢å‘åˆ‡é¢ç¼–ç¨‹)

### AOPåŸºæœ¬æ¦‚å¿µ

AOPï¼ˆAspect-Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨é€šè¿‡å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨ï¼‰ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»æ¥æé«˜æ¨¡å—åŒ–ç¨‹åº¦ã€‚

### æ ¸å¿ƒæœ¯è¯­

- **è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰**ï¼šç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸä¸ªç‰¹å®šç‚¹ï¼Œå¦‚æ–¹æ³•è°ƒç”¨æˆ–å¼‚å¸¸æŠ›å‡º
- **åˆ‡ç‚¹ï¼ˆPointcutï¼‰**ï¼šåŒ¹é…è¿æ¥ç‚¹çš„è¡¨è¾¾å¼ï¼Œç”¨äºç¡®å®šé€šçŸ¥åº”è¯¥åº”ç”¨åœ¨å“ªäº›è¿æ¥ç‚¹
- **é€šçŸ¥ï¼ˆAdviceï¼‰**ï¼šåœ¨ç‰¹å®šè¿æ¥ç‚¹ä¸Šæ‰§è¡Œçš„ä»£ç ï¼Œæœ‰5ç§ç±»å‹ï¼š
  - å‰ç½®é€šçŸ¥ï¼ˆBeforeï¼‰ï¼šç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰
  - åç½®é€šçŸ¥ï¼ˆAfterï¼‰ï¼šç›®æ ‡æ–¹æ³•å®Œæˆå
  - è¿”å›é€šçŸ¥ï¼ˆAfter-returningï¼‰ï¼šæ–¹æ³•æˆåŠŸè¿”å›å
  - å¼‚å¸¸é€šçŸ¥ï¼ˆAfter-throwingï¼‰ï¼šæ–¹æ³•æŠ›å‡ºå¼‚å¸¸å
  - ç¯ç»•é€šçŸ¥ï¼ˆAroundï¼‰ï¼šåŒ…å›´ç›®æ ‡æ–¹æ³•ï¼Œå¯åœ¨å‰åæ‰§è¡Œä»£ç 
- **åˆ‡é¢ï¼ˆAspectï¼‰**ï¼šé€šçŸ¥å’Œåˆ‡ç‚¹çš„ç»„åˆï¼Œå®šä¹‰äº†æ¨ªåˆ‡å…³æ³¨ç‚¹
- **ç»‡å…¥ï¼ˆWeavingï¼‰**ï¼šå°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†çš„è¿‡ç¨‹

### Spring AOPå®ç°åŸç†

Spring AOPä½¿ç”¨ä¸¤ç§ä»£ç†æœºåˆ¶ï¼š
1. **JDKåŠ¨æ€ä»£ç†**ï¼šé’ˆå¯¹å®ç°æ¥å£çš„ç±»ï¼ˆé»˜è®¤ï¼‰
2. **CGLIBä»£ç†**ï¼šé’ˆå¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»

**å®ç°æ­¥éª¤**ï¼š
1. è§£æåˆ‡é¢é…ç½®ï¼ˆ@Aspectæ³¨è§£æˆ–XMLé…ç½®ï¼‰
2. åˆ›å»ºä»£ç†å¯¹è±¡
3. åœ¨ä»£ç†å¯¹è±¡ä¸­æ ¹æ®åˆ‡ç‚¹åŒ¹é…æ‰§è¡Œç›¸åº”é€šçŸ¥

### ç¤ºä¾‹ä»£ç 

```java
// å®šä¹‰åˆ‡é¢
@Aspect
@Component
public class LoggingAspect {

    // å®šä¹‰åˆ‡ç‚¹
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceMethods() {}
    
    // å‰ç½®é€šçŸ¥
    @Before("serviceMethods()")
    public void beforeMethod(JoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().getName();
        System.out.println("Before method: " + methodName);
    }
    
    // åç½®é€šçŸ¥
    @After("serviceMethods()")
    public void afterMethod(JoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().getName();
        System.out.println("After method: " + methodName);
    }
    
    // ç¯ç»•é€šçŸ¥
    @Around("serviceMethods()")
    public Object aroundMethod(ProceedingJoinPoint pjp) throws Throwable {
        String methodName = pjp.getSignature().getName();
        System.out.println("Around before: " + methodName);
        try {
            Object result = pjp.proceed();
            System.out.println("Around after returning: " + methodName);
            return result;
        } catch (Exception e) {
            System.out.println("Around after throwing: " + methodName);
            throw e;
        }
    }
}
```

### Spring AOPçš„åº”ç”¨åœºæ™¯

1. **äº‹åŠ¡ç®¡ç†**ï¼š@Transactionalçš„å®ç°
2. **æ—¥å¿—è®°å½•**ï¼šæ–¹æ³•è°ƒç”¨ã€å‚æ•°ã€è¿”å›å€¼ã€æ‰§è¡Œæ—¶é—´çš„è®°å½•
3. **å®‰å…¨æ§åˆ¶**ï¼šæƒé™æ ¡éªŒ
4. **æ€§èƒ½ç›‘æ§**ï¼šæ–¹æ³•æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
5. **ç¼“å­˜**ï¼šæ–¹æ³•ç»“æœç¼“å­˜
6. **å¼‚å¸¸å¤„ç†**ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†å’Œè½¬æ¢

## Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜

### å¾ªç¯ä¾èµ–é—®é¢˜

å¾ªç¯ä¾èµ–æ˜¯æŒ‡ä¸¤ä¸ªæˆ–æ›´å¤šçš„beanç›¸äº’ä¾èµ–ï¼Œå½¢æˆä¾èµ–é—­ç¯çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š
- Aä¾èµ–Bï¼ŒBä¾èµ–A
- Aä¾èµ–Bï¼ŒBä¾èµ–Cï¼ŒCä¾èµ–A

### Springè§£å†³æ–¹æ¡ˆï¼šä¸‰çº§ç¼“å­˜

Springä¸»è¦é€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å•ä¾‹ä½œç”¨åŸŸä¸‹çš„setteræ³¨å…¥å’Œå­—æ®µæ³¨å…¥çš„å¾ªç¯ä¾èµ–ï¼š

1. **ä¸€çº§ç¼“å­˜ï¼ˆsingletonObjectsï¼‰**ï¼šå®Œå…¨åˆå§‹åŒ–å¥½çš„beanï¼ˆæˆå“ï¼‰
2. **äºŒçº§ç¼“å­˜ï¼ˆearlySingletonObjectsï¼‰**ï¼šæå‰æ›å…‰çš„beanï¼Œæœªå®Œå…¨åˆå§‹åŒ–ï¼ˆåŠæˆå“ï¼‰
3. **ä¸‰çº§ç¼“å­˜ï¼ˆsingletonFactoriesï¼‰**ï¼šbeançš„å·¥å‚å¯¹è±¡ï¼Œç”¨äºç”Ÿæˆæå‰æ›å…‰çš„bean

### è§£å†³æµç¨‹

å‡è®¾æœ‰Aã€Bå¾ªç¯ä¾èµ–ï¼š

1. **åˆ›å»ºA**ï¼š
   - å®ä¾‹åŒ–Aå¯¹è±¡ï¼ˆæœªåˆå§‹åŒ–å±æ€§ï¼‰
   - å°†Aæ”¾å…¥ä¸‰çº§ç¼“å­˜ï¼ˆsingletonFactoriesï¼‰
   - å¼€å§‹å¯¹Aè¿›è¡Œå±æ€§å¡«å……ï¼Œå‘ç°ä¾èµ–B

2. **åˆ›å»ºB**ï¼š
   - å®ä¾‹åŒ–Bå¯¹è±¡ï¼ˆæœªåˆå§‹åŒ–å±æ€§ï¼‰
   - å°†Bæ”¾å…¥ä¸‰çº§ç¼“å­˜
   - å¼€å§‹å¯¹Bè¿›è¡Œå±æ€§å¡«å……ï¼Œå‘ç°ä¾èµ–A
   - å°è¯•ä»ç¼“å­˜è·å–Aï¼š
     - ä¸€çº§ç¼“å­˜æ²¡æœ‰ï¼ŒäºŒçº§ç¼“å­˜æ²¡æœ‰
     - ä»ä¸‰çº§ç¼“å­˜æ‰¾åˆ°Açš„å·¥å‚ï¼Œé€šè¿‡å·¥å‚è·å–æ—©æœŸå¼•ç”¨
     - å°†Aä»ä¸‰çº§ç¼“å­˜å‡çº§åˆ°äºŒçº§ç¼“å­˜
   - ç”¨ä»äºŒçº§ç¼“å­˜è·å–çš„Aå®ŒæˆBçš„å±æ€§å¡«å……
   - Båˆå§‹åŒ–å®Œæˆï¼Œä»äºŒçº§ã€ä¸‰çº§ç¼“å­˜ç§»é™¤ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜

3. **ç»§ç»­åˆ›å»ºA**ï¼š
   - ä»ä¸€çº§ç¼“å­˜è·å–å·²åˆ›å»ºå®Œæˆçš„B
   - å®ŒæˆAçš„å±æ€§å¡«å……
   - Aåˆå§‹åŒ–å®Œæˆï¼Œä»äºŒçº§ã€ä¸‰çº§ç¼“å­˜ç§»é™¤ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜

### å…³é”®ä»£ç è§£æ

```java
// AbstractAutowireCapableBeanFactoryç±»çš„doCreateBeanæ–¹æ³•ä¸­å…³é”®éƒ¨åˆ†
protected Object doCreateBean(final String beanName, final RootBeanDefinition mbd, final @Nullable Object[] args)
        throws BeanCreationException {
    
    // å®ä¾‹åŒ–bean
    BeanWrapper instanceWrapper = createBeanInstance(beanName, mbd, args);
    final Object bean = instanceWrapper.getWrappedInstance();
    
    // æå‰æ›å…‰beanï¼ŒåŠ å…¥ä¸‰çº§ç¼“å­˜
    boolean earlySingletonExposure = (mbd.isSingleton() && this.allowCircularReferences &&
            isSingletonCurrentlyInCreation(beanName));
    if (earlySingletonExposure) {
        // åŠ å…¥ä¸‰çº§ç¼“å­˜
        addSingletonFactory(beanName, () -> getEarlyBeanReference(beanName, mbd, bean));
    }
    
    // å¡«å……beanå±æ€§
    populateBean(beanName, mbd, instanceWrapper);
    
    // åˆå§‹åŒ–bean
    exposedObject = initializeBean(beanName, exposedObject, mbd);
    
    // ...
}

// DefaultSingletonBeanRegistryç±»çš„getSingletonæ–¹æ³•
protected Object getSingleton(String beanName, boolean allowEarlyReference) {
    // ä»ä¸€çº§ç¼“å­˜æŸ¥æ‰¾
    Object singletonObject = this.singletonObjects.get(beanName);
    // å¦‚æœä¸å­˜åœ¨ï¼Œä¸”å½“å‰æ­£åœ¨åˆ›å»º
    if (singletonObject == null && isSingletonCurrentlyInCreation(beanName)) {
        synchronized (this.singletonObjects) {
            // ä»äºŒçº§ç¼“å­˜æŸ¥æ‰¾
            singletonObject = this.earlySingletonObjects.get(beanName);
            // å¦‚æœå…è®¸æ—©æœŸå¼•ç”¨ä¸”ä¸åœ¨äºŒçº§ç¼“å­˜
            if (singletonObject == null && allowEarlyReference) {
                // ä»ä¸‰çº§ç¼“å­˜è·å–å·¥å‚
                ObjectFactory<?> singletonFactory = this.singletonFactories.get(beanName);
                if (singletonFactory != null) {
                    // ä½¿ç”¨å·¥å‚åˆ›å»ºæ—©æœŸå¼•ç”¨
                    singletonObject = singletonFactory.getObject();
                    // æ”¾å…¥äºŒçº§ç¼“å­˜
                    this.earlySingletonObjects.put(beanName, singletonObject);
                    // ä»ä¸‰çº§ç¼“å­˜ç§»é™¤
                    this.singletonFactories.remove(beanName);
                }
            }
        }
    }
    return singletonObject;
}
```

### å¾ªç¯ä¾èµ–çš„é™åˆ¶æ¡ä»¶

Springä¸èƒ½è§£å†³æ‰€æœ‰å¾ªç¯ä¾èµ–åœºæ™¯ï¼š

1. **æ„é€ å™¨æ³¨å…¥çš„å¾ªç¯ä¾èµ–**ï¼šæ— æ³•è§£å†³ï¼Œå› ä¸ºå®ä¾‹åŒ–è¿‡ç¨‹ä¸­å°±éœ€è¦ä¾èµ–
2. **prototypeä½œç”¨åŸŸçš„å¾ªç¯ä¾èµ–**ï¼šæ— æ³•è§£å†³ï¼Œå› ä¸ºprototypeä½œç”¨åŸŸçš„beanä¸ä¼šç¼“å­˜
3. **ä½¿ç”¨@DependsOnå¯¼è‡´çš„å¾ªç¯ä¾èµ–**ï¼šæ— æ³•è§£å†³ï¼Œä¼šæŠ›å‡ºBeanCurrentlyInCreationException

### ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ

- **ä¸€çº§ç¼“å­˜**ï¼šå­˜æ”¾å®Œå…¨åˆå§‹åŒ–çš„bean
- **äºŒçº§ç¼“å­˜**ï¼šå­˜æ”¾æå‰æ›å…‰ä½†æœªå®Œå…¨åˆå§‹åŒ–çš„bean
- **ä¸‰çº§ç¼“å­˜**ï¼šå­˜æ”¾beanå·¥å‚ï¼Œä¸»è¦ç”¨äºæ”¯æŒAOPä»£ç†

å…³é”®ç‚¹ï¼šå¦‚æœbeanéœ€è¦è¢«AOPä»£ç†ï¼Œæœ€ç»ˆæ³¨å…¥çš„åº”è¯¥æ˜¯ä»£ç†å¯¹è±¡è€ŒéåŸå§‹å¯¹è±¡ã€‚ä¸‰çº§ç¼“å­˜ä¸­çš„å·¥å‚æ–¹æ³•ä¼šåœ¨åˆé€‚çš„æ—¶æœºåˆ›å»ºä»£ç†å¯¹è±¡ã€‚

å¦‚æœæ²¡æœ‰AOPçš„éœ€æ±‚ï¼Œç†è®ºä¸ŠäºŒçº§ç¼“å­˜è¶³ä»¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚